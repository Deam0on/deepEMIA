# =============================================================================
# INFERENCE CONFIGURATION
# =============================================================================
# All settings related to model inference and prediction

inference_settings:
  use_class_specific_inference: true
  
  iterative_stopping:
    min_total_masks: 10
    min_relative_increase: 0.25
    max_consecutive_zero: 1
    min_iterations: 2
  
  # Confidence threshold mode: 'manual' or 'auto'
  confidence_mode: 'auto'  # Set to 'manual' to use class_specific_settings thresholds
  
  class_specific_settings:
    class_0:  # Large particles
      confidence_threshold: 0.5
      iou_threshold: 0.7
      min_size: 25
      min_size_factor: 0.0001  # 0.01% of image area
    
    class_1:  # Small particles
      confidence_threshold: 0.3
      iou_threshold: 0.5
      min_size: 3  # Absolute minimum
      min_size_factor: 0.000005  # 0.0005% of image area (very aggressive)
      use_multiscale: true
  
  # Multi-model ensemble settings
  ensemble_settings:
    enabled: true
    small_classes_only: true  # Only use ensemble for small particles
    weights:
      R50: 0.6  # R50 better for small particles
      R101: 0.4  # R101 better for context
  
  # Multi-scale settings
  multiscale_settings:
    baseline_scales: [0.7, 1.0, 1.5, 2.0]  # Standard scales
    aggressive_scales: [1.0, 1.5, 2.0, 2.5, 3.0]  # For very small particles
    max_scale: 3.0

  # Tile-based inference settings
  use_tile_based_inference: true  # Enable for small particles
  
  tile_settings:
    tile_size: 512  # Base tile size before upscaling
    overlap_ratio: 0.1  # 10% overlap (reduced from 20%)
    upscale_factor: 2.0  # 2x upscaling for small particles
    edge_filter_enabled: true
    
    # Run tiling for all classes (not just small ones)
    classes_using_tiling: [0, 1]  # All classes use tiling
    
    # GPU batch processing for tiles
    tile_batch_size: 2  # Reduce from 4 to 2 for memory safety
